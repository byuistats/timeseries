---
title: "Time Series Homework: Chapter 5 Lesson 3"
subtitle: "Please_put_your_name_here"
format: 
  html:
    embed-resources: true
    toc: true
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Loading R packages

if (!require("pacman")) install.packages("pacman")
pacman::p_load(nlme,tsibble, fable,feasts, tsibbledata,
               fable.prophet, patchwork,lubridate, 
               rio,ggplot2,kableExtra,tidyquant, 
               dplyr , plotly,tidymodels, 
               multilevelmod, broom.mixed
)
```

## Data

```{r, message=FALSE}

c02 <- rio::import("https://byuistats.github.io/timeseries/data/co2_mm_mlo.csv")

```

## Questions

### Question 1 - Context and Measurement (5 points)

The first part of any time series analysis is context. You cannot properly analyze data without knowing what the data is measuring. Without context, the most simple features of data can be obscure and inscrutable. This homework assignment will center around the series below.

Please research the time series. In the spaces below, give the data collection process, unit of analysis, and meaning of each observation for the series.

#### a) **Atmospheric Carbon Dioxide**

[NOA](https://gml.noaa.gov/ccgg/about/co2_measurements.html)

::: {.callout-note title="Answer" icon="false"}
**Data Collection Process:** 

The data in this series was collected by the National Oceanic and Atmospheric Administration (NOAA) at the Mauna Loa Observatory in Hawaii. The data has been averaged to produce monthly values, however this comes from averaging hourly observations. Prior to April 2019, measurements were obtained using infrared absorption techniques; since then, Cavity Ring-Down Spectroscopy has been employed. To determine the final CO₂ concentration values, five calibration gases with known CO₂ levels are run through a standardized formula. The dataset spans from 1957 through 2024.

**Unit of Analysis:** The unit of analysis for the series is the average amount of Carbon dioxide particles observed per one million particles each month in dry air.

**Meaning of Each Observation:** Each observation represents the concentration of carbon dioxide (CO₂) in the atmosphere, measured in parts per million (ppm), indicating the amount of CO₂ relative to other atmospheric gases. CO₂ is a major greenhouse gas and one of the primary drivers of climate change. Tracking its concentration over time provides valuable insight into seasonal patterns and long-term trends related to human activity, fossil fuel combustion, and land-use changes.
:::

### Question 2 - Seasonal Pattern Exploration (20 points)

##### a) Plot the Atmospheric Carbon Dioxide series.

::: {.callout-note title="Answer" icon="false"}
```{r}
co2_ts <- c02 |>
  mutate(date = mdy(date))|>
  as_tsibble(index = date)

ggplot(co2_ts, aes(x = date, y = monthly_avg))+
  geom_line()+
  labs(x = "Year",
       y = "Average monthly CO2 observed (in ppm)") +
  theme_bw()


```
:::

##### b) Create box plot of the seasonal variation in co2 atmospheric measurements.

::: {.callout-note title="Answer" icon="false"}
```{r}

ggplot(co2_ts, aes(x = as.factor(month), y = monthly_avg))+
  geom_boxplot()+
  theme_bw()+
  labs(
    x = "Month",
    y = "Average monthly CO2 observed (in ppm)"
  )

```
:::

##### c) Please explain three likely factors that drive co2 seasonal patterns.

::: {.callout-note title="Answer" icon="false"}
An important factor to consider when examining seasonal patterns in CO₂ levels is travel activity, particularly vacations to Hawaii. The boxplot shows noticeable increases in carbon dioxide concentrations during May and June, months that coincide with the end of the school year in the United States when travel tends to spike. Similar increases appear in November and December, aligning with Thanksgiving and Christmas breaks, further suggesting that tourism may contribute to localized CO₂ increases. Another key factor is the ocean-atmosphere CO₂ exchange. During warmer months, surface ocean waters release more CO₂ into the atmosphere due to reduced gas solubility at higher temperatures. Additionally, plant photosynthesis plays a significant role. In colder months such as January and February, vegetation goes dormant or decays, resulting in lower CO₂ uptake and a relative rise in atmospheric CO₂ concentrations.
:::

### Question 3 - Model Selection: Additive Harmonic Seasonal Variables (50 points)

##### a) Using the atmospheric co2 time series, please estimate a linear model with a *linear trend* and harmonic seasonal variables. Include three models, one with the complete set of harmonic variables, and two with reduced harmonic components. Please use the Time Series Notebook Ch5 Lesson 3 result table format when presenting your results that include a column that identifies the variable as significant.

::: {.callout-note title="Answer" icon="false"}
```{r}
co2_harmonic <- c02 |>
  mutate(TIME = 1:n()) |>
  mutate(
    cos1 = cos(2 * pi * 1 * TIME/12),
    cos2 = cos(2 * pi * 2 * TIME/12),
    cos3 = cos(2 * pi * 3 * TIME/12),
    cos4 = cos(2 * pi * 4 * TIME/12),
    cos5 = cos(2 * pi * 5 * TIME/12),
    cos6 = cos(2 * pi * 6 * TIME/12),
    sin1 = sin(2 * pi * 1 * TIME/12),
    sin2 = sin(2 * pi * 2 * TIME/12),
    sin3 = sin(2 * pi * 3 * TIME/12),
    sin4 = sin(2 * pi * 4 * TIME/12),
    sin5 = sin(2 * pi * 5 * TIME/12),
    sin6 = sin(2 * pi * 6 * TIME/12)) |>
  as_tsibble(index = TIME) |>
  mutate(zTIME = (TIME - mean(TIME)) / sd(TIME))


full_linear_lm <- co2_harmonic |>
  model(full_linear = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ))

full_linear_lm |>
  tidy() |>
  mutate(sig = p.value < 0.05) |>
  pander::pander()

reduced_linear_1 <- co2_harmonic |>
  model(reduced_linear_1 = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 ))

reduced_linear_1 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

reduced_linear_2 <- co2_harmonic |>
  model(reduced_linear_2 = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + cos2  ))

reduced_linear_2 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

```
:::

##### b) Using the atmospheric co2 time series, please estimate a linear model with a *quadratic trend* and harmonic seasonal variables. Include three models, one with the complete set of harmonic variables, and two with reduced harmonic components. Please use the Time Series Notebook Ch5 Lesson 3 result table format when presenting your results that include a column that identifies the variable as significant.

::: {.callout-note title="Answer" icon="false"}
```{r}
full_quadratic_lm <- co2_harmonic |>
  model(full_quadratic = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ))

full_quadratic_lm |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

reduced_quadratic_1 <- co2_harmonic |>
  model(reduced_quadratic_1 = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 ))

reduced_quadratic_1 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

reduced_quadratic_2 <- co2_harmonic |>
  model(reduced_quadratic_2 = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1+ cos2))

reduced_quadratic_2 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

```
:::

##### c) Using the atmospheric co2 time series, please estimate a linear model with a *exponential trend* and harmonic seasonal variables. Include three models, one with the complete set of harmonic variables, and two with reduced harmonic components. Please use the Time Series Notebook Ch5 Lesson 3 result table format when presenting your results that include a column that identifies the variable as significant.

::: {.callout-note title="Answer" icon="false"}
```{r}
full_exponential_lm <- co2_harmonic |>
  model(full_exponential = TSLM(monthly_avg ~ exp(zTIME) + 
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ))

full_exponential_lm |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

reduced_exponential_1 <- co2_harmonic |>
  model(reduced_exponential_1 = TSLM(monthly_avg ~ exp(zTIME)  + 
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 ))
reduced_exponential_1 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

reduced_exponential_2 <- co2_harmonic |>
  model(reduced_exponential_2 = TSLM(monthly_avg ~ exp(zTIME) + 
    sin1 + cos1 + cos2 ))
reduced_exponential_2 |>
  tidy() |>
  mutate(sig = p.value < 0.05) 

```
:::

##### d) Please use AIC, AICc, and BIC to help you argue for the best model to fit the atmospheric co2 data. Please include a table similar to the one found in the Model Comparison section of Time Series Notebook Ch5 Lesson 3. Make sure you take into account the discussion on the dangers of *only* using algorithms for model selection found on the Time Series notebook section on model selection.

::: {.callout-note title="Answer" icon="false"}
```{r}
model_combined <- co2_harmonic |>
  model(
    full_exponential = TSLM(monthly_avg ~ exp(zTIME) + 
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ),
    full_quadratic = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ),
    full_linear = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ),
    reduced_exponential_1  = TSLM(monthly_avg ~ exp(zTIME)  + 
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 ),
    reduced_exponential_2  = TSLM(monthly_avg ~ exp(zTIME)  + 
    sin1 + cos1 + cos2 ),
    reduced_quadratic_1  = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 ),
    reduced_quadratic_2  = TSLM(monthly_avg ~ zTIME + I(zTIME^2) +
    sin1 + cos1+ cos2),
    reduced_linear_1  = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 ),
    reduced_linear_2  = TSLM(monthly_avg ~ zTIME +
    sin1 + cos1 + cos2  )
  )

glance(model_combined) |>
  select(.model, AIC, AICc, BIC)


```

While AIC, AICc, and BIC are useful tools for model selection, they should not be the only factors guiding your choice. In the table above, the reduced_quadratic_2 model has the lowest values for all three criteria, suggesting it has the best balance of fit and simplicity among the candidates. However, model interpretability and domain knowledge also matter as a slightly less optimal model in terms of information criteria may still be preferable if it is easier to explain or aligns more closely with known physical processes. For example, if the reduced_quadractic_1 model is more interpretable and only marginally worse in AIC, AICc, and BIC, it would be a more justifiable choice. It’s also worth being cautious about overfitting, especially when models become increasingly complex with diminishing returns in performance. 
:::

### Rubric

+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| **Criteria**                                                        | **Mastery (5)**                                                                                                                                                                                                                                                                                                                                                                                                | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 1: Context and Measurement**                        | The student thoroughly researches the data collection process, unit of analysis, and meaning of each observation for both the requested time series. Clear and comprehensive explanations are provided.                                                                                                                                                                                                        | The student does not adequately research or provide information on the data collection process, unit of analysis, and meaning of each observation for the specified series.                                                                |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (5)**                                                                                                                                                                                                                                                                                                                                                                                                | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 2a: Time series plot**                              | Students plot the Atmospheric Carbon Dioxide series, ensuring high-quality visualization with clear labels and titles.                                                                                                                                                                                                                                                                                         | Submissions have low-quality visualizations or unclear labeling.                                                                                                                                                                           |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (5)**                                                                                                                                                                                                                                                                                                                                                                                                | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 2b: Box Plot**                                      | Students create a box plot of the seasonal variation in CO2 atmospheric measurements, providing clear interpretation and labeling.                                                                                                                                                                                                                                                                             | Submissions have low-quality visualizations or unclear labeling.                                                                                                                                                                           |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                               | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 2c: Seasonal Patterns**                             | Students provide a clear and accurate explanation of three likely factors that drive CO2 seasonal patterns, demonstrating an understanding of the underlying time series and relevant environmental and ecological processes.                                                                                                                                                                                  | Students provide incomplete or inaccurate explanations of factors that drive CO2 seasonal patterns or fail to demonstrate an understanding of the data generation process and relevant environmental and ecological processes.             |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                               | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 3a: Linear Trend Harmonic Seasonal Variables**      | Students accurately estimate three linear models with a linear trend and harmonic seasonal variables, providing clear presentation of results including a column identifying significant variables.                                                                                                                                                                                                            | Students fail to estimate one or more of the models requested. The presentation of the results is unclear or incomplete, or fail to identify significant variables appropriately.                                                          |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                               | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 3b: Cuadratic Trend Harmonic Seasonal Variables**   | Students accurately estimate three linear models with a quadratic trend and harmonic seasonal variables, providing clear presentation of results including a column identifying significant variables.                                                                                                                                                                                                         | Students fail to estimate one or more of the models requested. The presentation of the results is unclear or incomplete, or fail to identify significant variables appropriately.                                                          |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                               | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 3c: Exponential Trend Harmonic Seasonal Variables** | Students accurately estimate three linear models with an exponential trend and harmonic seasonal variables, providing clear presentation of results including a column identifying significant variables.                                                                                                                                                                                                      | Students fail to estimate one or more of the models requested. The presentation of the results is unclear or incomplete, or fail to identify significant variables appropriately.                                                          |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
|                                                                     | **Mastery (20)**                                                                                                                                                                                                                                                                                                                                                                                               | **Incomplete (0)**                                                                                                                                                                                                                         |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| #### **Question 3d: Model Selection**                               | Students effectively use AIC, AICc, and BIC to compare and evaluate models, presenting results in a clear table format similar to the one found in the Model Comparison section of the Time Series Notebook Ch5 Lesson 3. Their discussions on the nuance model selection evidences they understand the importance of considering the context and data generating process that is part of model specification. | Students struggle to effectively use AIC, AICc, and BIC to compare and evaluate models, resulting in unclear or incomplete presentation of results or failure to address the dangers of relying solely on algorithms for model selection.\ |         |
|                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                | \                                                                                                                                                                                                                                          |         |
|                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                | \                                                                                                                                                                                                                                          |         |
|                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                | \                                                                                                                                                                                                                                          |         |
|                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                | \                                                                                                                                                                                                                                          |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
| **Total Points**                                                    | **75**                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |         |
+---------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+
