---
title: "Time Series Homework: Chapter 3 Lesson 3"
subtitle: "Please_put_your_name_here"
format: 
  html:
    embed-resources: true
    toc: true
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Loading R packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, 
               tsibble, fable,
               feasts, tsibbledata,
               fable.prophet,
               patchwork,
               lubridate, 
               rio,
               ggplot2,
               kableExtra
               )
```

## Data

```{r, message=FALSE}

df <- rio::import("https://raw.githubusercontent.com/TBrost/BYUI-Timeseries-Drafts/refs/heads/master/data/ILLNESS_CDCWONDER.csv") |>
  filter(`ICD Sub-Chapter Code` == "X60-X84")|> 
  mutate(yearmonth = yearmonth(Date))

df2 <- read_csv("https://raw.githubusercontent.com/TBrost/BYUI-Timeseries-Drafts/refs/heads/master/data/POPTHM.csv") |> 
  mutate(yearmonth = yearmonth(observation_date))

illness <- df |> left_join(df2, by="yearmonth") |>
  mutate(`Deaths per 100000` = (Deaths/POPTHM)*100000) |>
  select(-c(observation_date)) |>
  filter(Year <= 2019)

```

## A Note Before Starting, Please Read

The data we will be looking at today covers a topic of deaths due to self harm. This is a incredibly serious and heavy topic and we would be remissed to not include some message at the beginning of this. People struggle with self harm and suicide due to a variety of different reasons. It is important to remember the following teachings and doctrines of the Church of Jesus Christ of Latter-Day Saints when approaching this topic:

-   Mortal life is a precious gift that should be valued and protected (see D&C 18:10)
-   When someone takes their own life, only God is able to judge their thoughts, their actions and their level of accountability. Suicide need not be the defining characteristic of an individual's eternal life (see 1 Samuel 16:7)
-   Through His Atonement, Jesus Christ experienced the fullness of mortal challenges so He could know "how to succor his people according to their infirmities" (Alma 7:11-13)

If you are struggling with thoughts of suicide or self harm, please know this. The world is better with you in it. We love you and want you to be here, and God loves you with an eternal love. You are not the only person who has struggled with this and there is hope and healing ahead. Please reach out to the Lord, those you trust, and the suicide prevention hotline (found by calling 988). Click [here](https://www.byui.edu/counseling-center/emergency-contact) for additional resources from BYU-Idaho.

If you know of someone who is struggling, [here](https://www.byui.edu/human-resources/0000018d-9fb8-dfac-afad-9ff9fb6d0000) is a good video with advice. As well the Church has additional resources that can be found in Gospel Library by going to the Life Help section under suicide.

## Questions

### Question 1 - Context and Measurement (10 points)

The first part of any time series analysis is context. You cannot properly analyze data without knowing what the data is measuring. Without context, the most simple features of data can be obscure and inscrutable. This homework assignment will center around the series below.

Please research the time series. In the spaces below, give the data collection process, unit of analysis, and meaning of each observation for the series.

#### **US Self Harm**

[CDC Website](https://wonder.cdc.gov/wonder/help/ucd.html#)

::: {.callout-note title="Answer" icon="false"}
**Description:** The CDC Wonder data set contains mortality data for many different illnesses and afflictions. This data has been limited to their self harm data, which related to deaths caused when a person takes their own life. As of 2001 that now includes those who lose their life committing acts of terrorism and as of 2014 includes about 42% of cases previously labeled as accidental discharge of a firearm.

**Data Collection Process:** The data is collected monthly by the CDC going through the state registries and adding the information to the National Vital Statistics. Each death certificate has a primary cause of death, as well as up to 20 other additional causes.

**Unit of Analysis:** The unit of analysis is deaths per 100,000 due to suicide and self harm in the United States.

**Meaning of Each Observation:** Each monthly observation in the series reflects how many people out of 100,000 have died due to self harm that month.
:::

### Question 2 - Additive Holt-Winters Forecasting (30 points)

This series imported above has not been seasonally adjusted.

##### a) Please use the Holt-Winters smoothing method to the series.

::: {.callout-note title="Answer" icon="false"}
```{r}

illness_ts <- illness |>
  as_tsibble()

ggplot(illness_ts, aes(x=yearmonth, y = `Deaths per 100000`))+
  geom_line()+
  theme_bw()

illness_hw <- illness_ts |>
  tsibble::fill_gaps() |>
  model(Additive = ETS(`Deaths per 100000` ~
                         trend("A", alpha = 0.15, beta = 0.0005) +
                         error("A") +
                         season("A", gamma = 0.01),
                       opt_crit = "amse", nmse = 1))

report(illness_hw)

autoplot(components(illness_hw)) 

augment(illness_hw) |>
    ggplot(aes(x = yearmonth, y = `Deaths per 100000`)) +
    geom_line(aes(color = "Original")) +
    geom_line(aes(y = .fitted, color = "Fitted")) +
  theme_bw()+
  scale_color_manual(values = c("Original" = "black", "Fitted" = "coral1")) +
    labs(x = "Year",
         y = "Deaths per 100,000",
         color = "",
         title = "Original Series with Holt-Winters Model")+
  theme(legend.position = "bottom")

```
:::

##### b) What parameters values did you choose for $\alpha$, $\beta$, and $\gamma$. Justify your choice.

::: {.callout-note title="Answer" icon="false"}
An α of 0.15 was chosen because the underlying baseline rate of mortality is expected to be relatively consistent, requiring the model to smooth out short-term fluctuations rather than overreact to them. Similarly, a very small β of 0.0005 was implemented, reflecting the assumption that any trend in mortality rates is established over long periods and should not be heavily influenced by recent, potentially noisy observations, thereby prioritizing historical trend stability. A small γ of 0.01 was selected because seasonal patterns in such data are typically stable and evolve slowly, meaning the model should place less emphasis on current observations when updating its seasonal components. Collectively, these relatively small parameter values ensure the model produces smooth and stable estimates of the level, trend, and seasonality, making it robust to noise and suitable for phenomena like public health trends that generally exhibit gradual changes.
:::

##### c) Please plot the Holt-Winters forecast of the series for the next 24 months superimposed against the original series. Please see [Figure 7](https://byuistats.github.io/timeseries/chapter_3_lesson_4.html#fig-crime-hw-forecast) in Chapter 3: Lesson 3

::: {.callout-note title="Answer" icon="false"}
```{r}
illness_hw |>
  forecast(h = "24 months") |> 
  autoplot(illness_ts, level = 95) + 
  geom_line(aes(y = .fitted, color = "Fitted"),
    data = augment(illness_hw)) +
  scale_color_discrete(name = "") +
  theme_bw() +
    labs(x ="Date")+
  theme(legend.position = "bottom")



```
:::

### Question 3 - Additive Holt-Winters Forecasting: Evaluation (20 points)

##### a) The data has been filtered to stop around 2019. Bellow we have the complete series, please don't look at it until you have reached this point in the homework. Compare your forecasting work with with the actual realization of the series. What lessons about forecasting can you learn from the occurrence of [Gray Rhino](https://chatgpt.com/share/6712c9e5-4f58-8005-888d-acae9895bd05) events like a pandemic?

::: {.callout-note title="Answer" icon="false"}
```{r}
illness_curent <- df |> left_join(df2, by="yearmonth") |>
  mutate(`Deaths per 100000` = (Deaths/POPTHM)*100000) |>
  select(-c(observation_date)) 

forecast_data <- illness_hw |>
  forecast(h = "24 months")

illness_curent_ts <- illness_curent |>
  as_tsibble()

autoplot(forecast_data, illness_ts, level = 95) +
  geom_line(data = illness_curent_ts, 
            aes(x = yearmonth, y = `Deaths per 100000`, color = "Actual")) +
  geom_line(aes(y = .fitted, color = "Fitted"),
            data = augment(illness_hw)) +
  scale_color_manual(values = c("Fitted" = "orange", "Actual" = "black")) +
  labs(x = "Date", y = "Deaths per 100,000", color = "") +
  theme_bw() +
  theme(legend.position = "bottom")
```

We can see that the forecast is fairly higher than what actually occurred in the data. This highlights the grey rhino effect— a high-impact, foreseeable event often underestimated in risk assessment. While the pandemic’s risks were known, they were largely ignored in routine forecasts, underscoring a key limitation: standard models often fail to account for foreseeable shocks. This gap between forecasted and actual values emphasizes the need for forecasting frameworks to integrate “grey rhino” scenarios to better prepare for major, probable risks.
:::

### Rubric

|  |  |  |
|-----------------|----------------------------|---------------------------|
| **Criteria** | **Mastery (10)** | **Incomplete (0)** |
| **Question 1a: HW Smoothing** | Demonstrate the implementation of the Holt-Winters smoothing method in R, providing well-commented code that clearly explains each step of the algorithm. They correctly specify the necessary parameters, including trend and seasonality components. | Students encounter difficulties in accurately implementing the Holt-Winters smoothing method in R. Their code may lack sufficient comments or clarity, making it challenging to understand the implementation process. Additionally, they may overlook important parameters or make errors in the application of the method, leading to inaccuracies in the results. |
|  | **Mastery (10)** | **Incomplete (0)** |
| **Question 1b: Parameter Choice** | Responses not only specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$ in the context of the Holt-Winters smoothing method but also correctly identify the purpose of each parameter in their explanation. They provide a thorough justification for each parameter choice, considering factors such as the data characteristics, seasonality patterns, and the desired level of smoothing | Student struggles to clearly specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$. It's no clear that they understand the purpose of each parameter in their explanation. They may provide limited or vague justification for each parameter choice, lacking consideration of important factors such as data characteristics or seasonality patterns. |
|  | **Mastery (10)** | **Incomplete (0)** |
| **Question 1c: Forecast Plot** | Responses effectively create a plot of the Holt-Winters forecast for the next 24 months superimposed against the original series in R. The forecasted values align with the original series and display relevant trends and seasonality patterns. Additionally, they appropriately label the axes, title the plot, and provide a clear legend to distinguish between the original series and the forecast. The plot closely resembles Figure 7 in the Time Series Notebook | Student encounter challenges in creating a plot of the Holt-Winters forecast. They may struggle with accurately implementing the plotting code, resulting in inaccuracies or inconsistencies in the plotted forecast. Additionally, their plot may lack proper labeling of the axes, a title, or a legend, making it difficult to interpret the information presented. Furthermore, their plot may deviate significantly from Figure 7 in the Time Series Notebook. |
|  | **Mastery (20)** | **Incomplete (0)** |
| **Question 1a: Gray Rhinos** | Students provide a comparison between their forecasting results and the actual realization of the series, highlighting areas of accuracy and any discrepancies observed. They demonstrate an understanding of the impact of Gray Rhino event on forecasting. Responses are clear, coherent, and well-structured, ensuring that the evaluation and lessons learned are effectively communicated | Submissions provide a limited or superficial comparison between their forecasting results and the actual realization of the series, lacking depth in their analysis or failing to identify key discrepancies.Responses demonstrate a lack of understanding of the impact of Gray Rhino events on forecasting. Explanations may lack clarity, coherence, or structure, making it difficult to understand the evaluation and lessons learned effectively. |
| **Total Points** | **50** |  |
