---
title: "Time Series Homework: Chapter 5 Lesson 5 kEY"
subtitle: "Please_put_your_name_here"
format: 
  html:
    embed-resources: true
    toc: true
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Loading R packages

if (!require("pacman")) install.packages("pacman")
pacman::p_load(nlme, tsibble, fable,feasts, tsibbledata,
               fable.prophet, patchwork,lubridate, 
               rio,ggplot2,kableExtra,tidyquant, 
               dplyr , plotly,tidymodels, 
               multilevelmod, broom.mixed
)
```

## Data

```{r, message=FALSE}

food_bev_ts <- rio::import("https://byuistats.github.io/timeseries/data/retail_by_business_type.parquet") |>
  filter(naics == 445) |>
  as_tsibble(index = month)

```

## Questions


### Question 2 - Logarithmic Transformation Estimation and Bias Correction (60 points)

You used the Food and Beverage Retail Sales series (NAICS: 4521) in the previous homework assignment. You estimated it with non-linear exponential model.

a)  Please estimate the Food and Beverage Retail Sales series using the logarithmic transformation of the series. Report the results in a professionally formatted table.

::: {.callout-note title="Answer" icon="false"}
```{r}

food_harmonics <- food_bev_ts  |>
  mutate(TIME = 1:n()) |>
  as_tsibble(index = TIME) |>
  mutate(zTIME = (TIME - mean(TIME)) / sd(TIME))|>
  mutate(
    cos1 = cos(2 * pi * 1 * TIME/12),
    cos2 = cos(2 * pi * 2 * TIME/12),
    cos3 = cos(2 * pi * 3 * TIME/12),
    cos4 = cos(2 * pi * 4 * TIME/12),
    cos5 = cos(2 * pi * 5 * TIME/12),
    cos6 = cos(2 * pi * 6 * TIME/12),
    sin1 = sin(2 * pi * 1 * TIME/12),
    sin2 = sin(2 * pi * 2 * TIME/12),
    sin3 = sin(2 * pi * 3 * TIME/12),
    sin4 = sin(2 * pi * 4 * TIME/12),
    sin5 = sin(2 * pi * 5 * TIME/12),
    sin6 = sin(2 * pi * 6 * TIME/12)) 


full_cubic_lm <- food_harmonics |>
  model(full_cubic = TSLM(log(sales_millions) ~ zTIME + I(zTIME^2) + I(zTIME^3) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 )) 
full_cubic_lm |>
  tidy() |>
  mutate(sig = p.value < 0.05)

model_combined <- food_harmonics |>
  model(
    full_cubic = TSLM(log(sales_millions) ~ zTIME + I(zTIME^2) + I(zTIME^3) +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ),
    full_linear = TSLM(log(sales_millions) ~ zTIME  +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ),
    full_quadratic = TSLM(log(sales_millions) ~ zTIME + I(zTIME^2)  +
    sin1 + cos1 + sin2 + cos2 + sin3 + cos3 
    + sin4 + cos4 + sin5 + cos5 + cos6 ))


glance(model_combined) |>
  select(.model, AIC, AICc, BIC)

```
:::

b)  Please justify your model specification.

::: {.callout-note title="Answer" icon="false"}
We chose the cubic model specification after fitting several polynomial models to the log-transformed sales data. The use of a log transformation was motivated by the observed exponential growth pattern in the data, which suggests that a model capturing proportional rather than additive changes over time would be more appropriate. When we fit the cubic model, we found that all terms were statistically significant. As well the cubic model had the lowest AIC, AICc and BIC showing the model fit the data best.
:::

c)  Please interpret the estimates for the coefficients of the logarithmic transformation model. Pretend you are presenting the results to an executive who took a linear regression course in undergraduate but is not an expert.

::: {.callout-note title="Answer" icon="false"}
The model we fitted predicts the logarithm of sales based on both long-term trends and seasonal patterns. The intercept represents the baseline level of log-sales around the center of the time period. The negative coefficients for the linear and quadratic time terms indicate an initial decline in growth, while the positive cubic term suggests that sales begin to recover or accelerate again later capturing a curved, non-linear trend over time. The sinusoidal (sine and cosine) terms capture recurring seasonal effects at multiple frequencies. All of these terms are statistically significant, meaning both the long-term trend and seasonality are strongly supported by the data. Together, the model reflects a realistic pattern of declining growth followed by recovery, overlaid with regular seasonal fluctuations in sales.
:::

d)  Please evaluate the estimation residuals and use the appropriate bias correction procedure for log-transform estimates. Please justify your choice.

::: {.callout-note title="Answer" icon="false"}
```{r}

food_resid_df <- model_combined |> 
  dplyr::select(full_cubic) |>
  residuals() |> 
  as_tibble() |> 
  dplyr::select(.resid) |>
  rename(x = .resid) 


skewness(food_resid_df$x)


food_resid_df |>
  mutate(density = dnorm(x, mean(food_resid_df$x), sd(food_resid_df$x))) |>
  ggplot(aes(x = x)) +
    geom_histogram(aes(y = after_stat(density)),
        color = "white", fill = "#56B4E9", binwidth = 0.01) +
    geom_line(aes(x = x, y = density)) +
    theme_bw() +
    labs(
      x = "Values",
      y = "Frequency",
      title = ""
    ) +
    theme(
      plot.title = element_text(hjust = 0.5)
    )
```

The skewness of the residuals is at 0.682, meaning there is moderate positive skewness in the residuals. Due to this we can apply log normal correction as bias correction. We do this instead of emperical correction as the residuals are positively skewed. 
:::

### Question 3 - Logarithmic Transformation vs Non-linear Estimation (40 points)

You have estimated and interpreted two models for the Food and Beverage Retail Sales series.

a)  Compare the relative ease of interpreting and explaining the regression coefficients.

::: {.callout-note title="Answer" icon="false"}
<!-- Delete this and put your answer here. The three colons mark the end of your answer. -->
:::

b)  Use the AIc, AICc, and BIC to compare your prefer specifications of each model.

::: {.callout-note title="Answer" icon="false"}
```{r}



```

<!-- Delete this and put your answer here. The three colons mark the end of your answer. -->
:::

### Rubric

+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Criteria**                                              | **Mastery (5)**                                                                                                                                                                                                                                                                                                                                                                                                                                                   | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 1: Definitions**                          | The student provides sufficient evidence of mastery of the outcome prompt. The submission included mathematical expressions or illustration if available in the text or the Time Series Notebook                                                                                                                                                                                                                                                                  | The student did not provide sufficient evidence to evaluate the outcome prompt.                                                                                                                                                                                                                                                           |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (20)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 2a: Log Estimation**                      | Students propose three alternative models that are plausible candidates for the data-generating process of the time series. The estimates include a models for the trend, seasonality, and random component. If there is autocorrelated error terms, the students apply the appropriate algorithm to avoid bias.                                                                                                                                                  | There is one or more models missing. The estimation procedures has autocorrelation bias. There is one or more model components missing (trend, seasonality, random component). The table and results are not easy to read. One or more models are not plausible candidates for the data generating process. The code is not easy to read. |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 2b: Model Selection**                     | They estimate each model and construct a clear and organized table comparing the models based on the AIC, AICc, and BIC criteria. The code is well-commented and easy to read.                                                                                                                                                                                                                                                                                    | There is one or more model selection criteria missing. Their justification lacks a discussion of the non-algorithmic factors influencing model selection.                                                                                                                                                                                 |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (10)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 2c: Interpretation of Estimates**         | Students provide correct and understandable interpretations of the coefficient estimates for the logarithmic transformation model, catering to the level of their audience. They effectively communicate the implications of each coefficient in straightforward language, making the interpretation accessible to someone with limited statistical expertise.                                                                                                    | Interpretations of the coefficient estimates are incorrect or unclear, making it difficult for a non-expert audience to understand the implications of the results. Students may use overly technical or jargon-filled language, failing to effectively communicate the interpretation to the intended audience.\                         |
|                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | \                                                                                                                                                                                                                                                                                                                                         |
|                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | \                                                                                                                                                                                                                                                                                                                                         |
|                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | \                                                                                                                                                                                                                                                                                                                                         |
|                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | \                                                                                                                                                                                                                                                                                                                                         |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (20)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 2d:Bias Correction**                      | Students evaluate the estimation residuals, using a histogram to identify patterns that may indicate bias in the log-transform estimates. They select the appropriate bias correction procedure based on their assessment, considering factors such as the nature of the data, the assumptions of the bias correction method, and the potential impact on model accuracy. Their justification is clear, reasoned, and takes into account relevant considerations. | Students don't adequately evaluate the estimation residuals or choose an appropriate bias correction procedure. Their analysis of the residuals may lack depth or overlook important patterns, such as skewness or outliers, which could indicate bias. The justification for the chosen method may be vague or lack detail.              |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (20)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 3a: Ease of Interpretation**              | Students compare the ease of interpreting and explaining the regression coefficients between the two models. They highlight the differences in interpretation stemming from the functional form of each model and articulate how these differences impact the clarity and intuitiveness of the coefficients' meanings.                                                                                                                                            | Students don't provide enough evidence that they understand how to interpret regression coefficients.                                                                                                                                                                                                                                     |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                           | **Mastery (20)**                                                                                                                                                                                                                                                                                                                                                                                                                                                  | **Incomplete (0)**                                                                                                                                                                                                                                                                                                                        |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| #### **Question 3b: Log vs Non-Linear Exponential Model** | Students effectively use AIC, AICc, and BIC to compare model specifications, providing insightful analysis on the trade-offs between model complexity and goodness of fit. They justify their preferred model based on the results of these criteria.                                                                                                                                                                                                             | There is one or more model selection criteria missing. Their justification lacks a discussion of the non-algorithmic factors influencing model selection.                                                                                                                                                                                 |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Total Points**                                          | **105**                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                           |
+-----------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
